<html>
<head>
  <title>Chess Video Game Beta</title>

  <script type="text/javascript" src="/jquery-3.1.1.min.js"></script> 
  <link rel="stylesheet" type="text/css" href="/chessboardjs/css/chessboard-0.3.0.min.css">
  <script type="text/javascript" src="/chessboardjs/js/chessboard-0.3.0.min.js"></script>
  <script type="text/javascript" src="/fetch.js"></script>

</head>
<body>

  <!-- The chess board container  -->

  <div id="board" style="width: 400px"></div>

  <script>

  function onDrop(source, target, piece, newPos) {

    fetch(bestMovePath(newPos))
      .then(function (response) {
         return response.json();
      })
      .then(function (json) {
        var move = uciToBoardMove(json.bestmove);
        board.move(move);
      });
  }

  function bestMovePath(position) {
    return '/bestmove/' + encodeURIComponent(ChessBoard.objToFen(position));
  }

  function uciToBoardMove(move) {
    return move.replace(/([a-h][1-8])([a-h][1-8])/, '$1-$2');
  }

  var board = ChessBoard('board', {
    pieceTheme: '/chessboardjs/img/chesspieces/wikipedia/{piece}.png',
    position: 'start',
    draggable: true,
    onDrop: onDrop,
  });

  var puzzle = {
    fen: 'k7/5ppp/8/5PPP/8/1K6/8/8 w - -',
    win: [
      ['checkmate']
    ],
    lose: [
      ['moveLimit', 30 ],
      ['checkmated'],
      ['time', 90],
      ['evaluationChange', -3]
    ]
  };
  //... make the chessboard appear with an initial position of puzzle.fen
  </script>
</body>
</html>
